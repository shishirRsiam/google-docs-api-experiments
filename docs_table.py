from google.auth import default
from googleapiclient.discovery import build
import json

# --- ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ---
DOC_TITLE = 'API: ржЯрзЗржмрж┐рж▓ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржЯрзЗрж╕рзНржЯ ржбржХрзБржорзЗржирзНржЯ'
PLACEHOLDER_TEXT = '<<HTML TAG>>\n\n<<HTML TAG>>\n\n<<Other TAG>>'

# Docs API ржПрж░ ржЬржирзНржп ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ рж╕рзНржХрзЛржк
SCOPES = ['https://www.googleapis.com/auth/documents', 'https://www.googleapis.com/auth/drive']


# ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рж╕рж░ржмрж░рж╛рж╣ржХрзГржд JSON рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ (Python ржбрж┐ржХрж╢ржирж╛рж░рж┐ рж╣рж┐рж╕рзЗржмрзЗ)
TABLE_INSERTION_REQUESTS = [
    {
        "insertTable": {
            "rows": 10,
            "columns": 2,
            "location": {
                "index": 1  # ржбржХрзБржорзЗржирзНржЯрзЗрж░ рж╢рзБрж░рзБрждрзЗ ржЯрзЗржмрж┐рж▓ржЯрж┐ рждрзИрж░рж┐ рж╣ржмрзЗ
            }
        }
    },
    # ржЯрзЗржмрж┐рж▓ рж╕рзЗрж▓рзЗ рждржерзНржп рж╕ржирзНржирж┐ржмрзЗрж╢рзЗрж░ ржЕржирзБрж░рзЛржз
    { "insertText": { "location": { "index": 2 },  "text": "ржХрзНрж░ржорж┐ржХ" }},
    { "insertText": { "location": { "index": 3 },  "text": "ржмрж┐ржмрж░ржг" }},
    { "insertText": { "location": { "index": 6 },  "text": "рззржо ржЬржмрзНржжрждрж╛рж░рж┐ржЦ" }},
    { "insertText": { "location": { "index": 7 },  "text": "рзжрзо ржЬрзБрж▓рж╛ржЗ, рзирзжрзирзл" }},
    { "insertText": { "location": { "index": 10 }, "text": "рж╕ржоржпрж╝" }},
    { "insertText": { "location": { "index": 11 }, "text": "рззрзи:рзлрзж ржШржЯрж┐ржХрж╛" }},
    { "insertText": { "location": { "index": 14 }, "text": "ржкрзНрж░рж╕рзНрждрзБрждржХрж╛рж░рзА ржХрж░рзНржоржХрж░рзНрждрж╛" }},
    { "insertText": { "location": { "index": 15 }, "text": "рж╕рж╛ржм-ржЗржирзНрж╕ржкрзЗржХрзНржЯрж░ (ржирж┐ржГ) ржиржпрж╝ржи ржХрзБржорж╛рж░ ржЪржХрзНрж░ржмрж░рзНрждрзА" }},
    { "insertText": { "location": { "index": 18 }, "text": "ржмрж┐ржкрж┐ ржиржорзНржмрж░" }},
    { "insertText": { "location": { "index": 19 }, "text": "BP-7999015253" }},
    { "insertText": { "location": { "index": 22 }, "text": "ржпржирзНрждрзНрж░рзЗрж░ ржзрж░ржг" }},
    { "insertText": { "location": { "index": 23 }, "text": "DVR ржорзЗрж╢рж┐ржи" }},
    { "insertText": { "location": { "index": 26 }, "text": "ржмрзНрж░рзНржпрж╛ржирзНржб/ржХрзЛржорзНржкрж╛ржирж┐" }},
    { "insertText": { "location": { "index": 27 }, "text": "DHUA" }},
    { "insertText": { "location": { "index": 30 }, "text": "рж╣рж╛рж░рзНржб ржбрж┐рж╕рзНржХ ржХрзНрж╖ржорждрж╛" }},
    { "insertText": { "location": { "index": 31 }, "text": "4TB" }},
    { "insertText": { "location": { "index": 34 }, "text": "рж╣рж╛рж░рзНржб ржбрж┐рж╕рзНржХ рж╕рж┐рж░рж┐ржпрж╝рж╛рж▓ ржиржорзНржмрж░ (S/N)" }},
    { "insertText": { "location": { "index": 35 }, "text": "WCC7K3FAVX27" }},
    { "insertText": { "location": { "index": 38 }, "text": "рж╣рж╛рж░рзНржб ржбрж┐рж╕рзНржХ ржоржбрзЗрж▓ (MDL)" }},
    { "insertText": { "location": { "index": 39 }, "text": "WD40PURX-69N69Y0" }},
    { "insertText": { "location": { "index": 42 }, "text": "ржнрж┐ржбрж┐ржУрж░ ржмрж┐ржмрж░ржг" }},
    { "insertText": { "location": { "index": 43 }, "text": "ржШржЯржирж╛рж╕рзНржерж▓рзЗ ржпрж╛рждрж╛ржпрж╝рж╛рждрзЗрж░ ржнрж┐ржбрж┐ржУ рж╕ржВрж░ржХрзНрж╖рж┐ржд ржЖржЫрзЗ" }}
]


def main():
    """
    рж╕ржорзНржкрзВрж░рзНржг ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ рж╕ржорзНржкрж╛ржжржи ржХрж░рзЗ: 
    рзз. ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржУ рж╕рж╛рж░рзНржнрж┐рж╕ рждрзИрж░рж┐
    рзи. ржирждрзБржи ржбржХрзБржорзЗржирзНржЯ рждрзИрж░рж┐ ржУ ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ рж╕ржирзНржирж┐ржмрзЗрж╢
    рзй. ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ ржЯрзЗржХрзНрж╕ржЯ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи (ржорзБржЫрзЗ ржлрзЗрж▓рж╛)
    рзк. ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржПржмржВ рждржерзНржп рж╕ржирзНржирж┐ржмрзЗрж╢
    """
    document_id = None
    
    # --- рзз. ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржУ рж╕рж╛рж░рзНржнрж┐рж╕ ржмрж┐рж▓рзНржбрж┐ржВ ---
    print("ЁЯЪА API рж╕рзЗржЯржЖржк рж╢рзБрж░рзБ рж╣ржЪрзНржЫрзЗ...")
    try:
        credentials, project_id = default(scopes=SCOPES)
        docs_service = build('docs', 'v1', credentials=credentials)
        print("тЬЕ рж╕рж╛рж░рзНржнрж┐рж╕ рж╕ржлрж▓ржнрж╛ржмрзЗ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗред")

    except Exception as e:
        print(f"тЭМ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржмрж╛ рж╕рж╛рж░рзНржнрж┐рж╕ рждрзИрж░рж┐рждрзЗ рждрзНрж░рзБржЯрж┐: {e}")
        return

    # --- рзи. ржбржХрзБржорзЗржирзНржЯ рждрзИрж░рж┐ ржПржмржВ ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ рж╕ржирзНржирж┐ржмрзЗрж╢ ---
    print("\nЁЯУЭ ржирждрзБржи Google Doc рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ...")
    try:
        # ржирждрзБржи ржбржХрзБржорзЗржирзНржЯ рждрзИрж░рж┐
        doc = docs_service.documents().create(body={'title': DOC_TITLE}).execute()
        document_id = doc.get('documentId')
        document_url = f'https://docs.google.com/document/d/{document_id}/edit'

        # ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ ржЯрзЗржХрзНрж╕ржЯ рж╕ржирзНржирж┐ржмрзЗрж╢ (ржпрж╛рждрзЗ ржПржЯрж┐ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкрж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗ)
        docs_service.documents().batchUpdate(
            documentId=document_id,
            body={'requests': [{'insertText': {'location': {'index': 1}, 'text': PLACEHOLDER_TEXT}}]}
        ).execute()

        print(f"тЬЕ ржбржХрзБржорзЗржирзНржЯ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ! ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ ржЯрзЗржХрзНрж╕ржЯ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред")
        print(f"ЁЯФЧ URL: {document_url}")

    except Exception as e:
        print(f"тЭМ ржбржХрзБржорзЗржирзНржЯ рждрзИрж░рж┐ ржмрж╛ ржЯрзЗржХрзНрж╕ржЯ ржпрзЛржЧрзЗ рждрзНрж░рзБржЯрж┐: {e}")
        return

    # --- рзй. ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ ржЯрзЗржХрзНрж╕ржЯ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи (ржорзБржЫрзЗ ржлрзЗрж▓рж╛) ---
    print(f"\nЁЯЧСя╕П '{PLACEHOLDER_TEXT}' рж▓рзЗржЦрж╛ржЯрж┐ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкрж┐ржд (ржорзБржЫрзЗ ржлрзЗрж▓рж╛) рж╣ржЪрзНржЫрзЗ...")
    try:
        # ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ржЯрж┐ржХрзЗ ржлрж╛ржБржХрж╛ рж╕рзНржЯрзНрж░рж┐ржВ ("") ржжрж┐рзЯрзЗ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
        replace_requests = [
            {
                'replaceAllText': {
                    'containsText': {
                        'text': PLACEHOLDER_TEXT,
                        'matchCase': True 
                    },
                    'replaceText': "" 
                }
            }
        ]
        
        result = docs_service.documents().batchUpdate(
            documentId=document_id, 
            body={'requests': replace_requests}
        ).execute()
        
        replacements = result.get('replies')[0]['replaceAllText']['occurrencesChanged']
        print(f"тЬЕ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржи рж╕ржорзНржкржирзНржиред {replacements}ржЯрж┐ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред")

    except Exception as e:
        print(f"тЭМ ржЯрзЗржХрзНрж╕ржЯ ржкрзНрж░рждрж┐рж╕рзНржерж╛ржкржирзЗ рждрзНрж░рзБржЯрж┐: {e}")
        return
        
    # --- рзк. ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржПржмржВ рждржерзНржп рж╕ржирзНржирж┐ржмрзЗрж╢ (ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ JSON рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ) ---
    print("\nтЬНя╕П ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржУ рждржерзНржп рж╕ржирзНржирж┐ржмрзЗрж╢ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...")
    try:
        docs_service.documents().batchUpdate(
            documentId=document_id, 
            body={'requests': TABLE_INSERTION_REQUESTS}
        ).execute()
        
        print(f"тЬЕ ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржУ рждржерзНржп рж╕ржирзНржирж┐ржмрзЗрж╢ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржорзНржкржирзНржи рж╣ржпрж╝рзЗржЫрзЗред")

    except Exception as e:
        print(f"тЭМ ржЯрзЗржмрж┐рж▓ рж╕ржирзНржирж┐ржмрзЗрж╢рзЗ рждрзНрж░рзБржЯрж┐: {e}")

    print("\nтЬи ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ рж╕ржорзНржкржирзНржиред ржЙржкрж░рзЗ ржжрзЗржУрзЯрж╛ URL ржП ржбржХрзБржорзЗржирзНржЯржЯрж┐ ржжрзЗржЦрзБржиред")


if __name__ == '__main__':
    main()